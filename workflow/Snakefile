from snakemake.utils import validate
import os

include: "rules/download_gtdb_data.smk"
include: "rules/download_refseq_data.smk"
include: "rules/gtdb.smk"
include: "rules/download_genome_data.smk"
include: "rules/refseq.smk"

def all_input(wildcards):
    """
    Generate all inputs for the rule all
    """
    wanted_input = []

    base_dir = config["base_dir"]
    if config["download"]:
        wanted_input.append(os.path.join(base_dir, config["prefix"] + "." + config["method"] + ".proteomes"))
        if config["output"]["diamond"]:
            wanted_input.append(os.path.join(base_dir, config["prefix"] + "." + config["method"] + ".dmnd"))
        if config["output"]["blast"]:
            wanted_input.append(os.path.join(base_dir, config["prefix"] + "." + config["method"] + ".pdb"))
    else:
        wanted_input.append(os.path.join(base_dir, config["prefix"] + "." + config["method"] + ".sampled_accessions.txt"))




    return wanted_input

validate(config, schema="validation_schemes/config.schema.yaml")

if config["sample_gtdb"]["gtdb_species_representative"]:
    config["sample_gtdb"]["gtdb_species_representative"] = "--gtdb_representative"
else:
    config["sample_gtdb"]["gtdb_representative"] = ""


rule all:
    input: all_input
